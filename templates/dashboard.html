<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <div class="sidebar">
        <h2>Market Sim</h2>
        <a href="/factories" class="menu-item active">üè≠ Factories</a>
        <a href="/market" class="menu-item">üåç Sales Market</a>
        <a href="/marketing" class="menu-item">üì¢ Marketing</a>
        <a href="/finance" class="menu-item">üí∞ Finance</a>
    </div>

    <div class="main-content">
        <h1>Production Management</h1>
        
        {% for country_name, config in country_config.items() %}
        
        <div class="factory-card">
            <div class="card-header">
                <h2>{{ country_name }}</h2>
                
                {% if player_factories[country_name] %}
                    <span class="stats">
                        Capacity: 
                        <b>{{ player_factories[country_name].total_lines_used }}</b> 
                        / {{ config.max_capacity }}
                    </span>
                {% else %}
                    <span class="stats">Not Established</span>
                {% endif %}
            </div>

            {% if not player_factories[country_name] %}
                <p>Establish a production site in {{ country_name }}.</p>
                <p><b>Efficiency:</b> x{{ config.efficiency_multiplier }} | <b>Setup Cost:</b> ${{ setup_costs[country_name] }}</p>
                
                <form action="/buy_factory" method="POST">
                    <input type="hidden" name="country" value="{{ country_name }}">
                    <button type="submit" class="btn-buy">Initialize Factory (-${{ setup_costs[country_name] }})</button>
                </form>

            {% else %}
                {% set factory = player_factories[country_name] %}
                
                <div class="production-grid">
                    {% for product in all_products %}
                    <div class="line-control">
                        <div style="width: 150px;">
                            <strong>Product {{ product }}</strong><br>
                            <span style="font-size: 0.8em; color: green;">
                                Output: {{ (factory.product_lines.get(product, 0) * 100 * config.efficiency_multiplier)|int }} units
                            </span>
                        </div>

                        <form action="/modify_lines" method="POST" style="display:inline;">
                            <input type="hidden" name="country" value="{{ country_name }}">
                            <input type="hidden" name="product" value="{{ product }}">
                            <input type="hidden" name="qty" value="-1">
                            <button class="line-btn" {% if factory.product_lines.get(product, 0) == 0 %}disabled style="background:#ccc"{% endif %}>-</button>
                        </form>

                        <span class="line-display">{{ factory.product_lines.get(product, 0) }} Lines</span>

                        <form action="/modify_lines" method="POST" style="display:inline;">
                            <input type="hidden" name="country" value="{{ country_name }}">
                            <input type="hidden" name="product" value="{{ product }}">
                            <input type="hidden" name="qty" value="1">
                            <button class="line-btn" {% if factory.free_space == 0 %}disabled style="background:#ccc"{% endif %}>+</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                
                <div style="margin-top: 15px; font-size: 0.9em; color: #e74c3c;">
                    Maintenance Cost: ${{ factory.maintenance_cost() }} / turn
                </div>
            {% endif %}
        </div>
        
        {% endfor %}

    </div>

</body>
</html>