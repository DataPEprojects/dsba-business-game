<!DOCTYPE html>
<html>
<!-- TEMPLATE: Turn overview - Display sales results, rankings, and end turn button -->
<head>
    <link rel="stylesheet" href="/static/style.css">
    <title>End of Turn</title>
    <style>
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ranking-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        .ranking-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        .ranking-table tr:hover {
            background: #f8f9fa;
        }
        .rank-badge {
            display: inline-block;
            width: 35px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            color: white;
        }
        .rank-1 { background: #f39c12; }
        .rank-2 { background: #95a5a6; }
        .rank-3 { background: #cd7f32; }
        .rank-other { background: #7f8c8d; }
        .player-row {
            background: #e8f8f5 !important;
            font-weight: 600;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Market Sim</h2>
        <a href="/factories" class="menu-item"> Factories</a>
        <a href="/production" class="menu-item"> Production</a>
        <a href="/market" class="menu-item"> Sales Market</a>
        <a href="/overview" class="menu-item active"> Overview & End</a>
        
        <div style="margin-top:auto; padding-top:20px; border-top:1px solid #34495e;">
            <p style="font-size:0.9em; color:#bdc3c7;">Cash Available:</p>
            <h3 style="color:#2ecc71;">${{ player_cash }}</h3>
            <p style="font-size:0.8em; color:#7f8c8d; margin-top:5px;">Turn {{ current_turn }}</p>
        </div>
    </div>

    <div class="main-content">
        
        <h1>Turn Overview - {{ current_turn }}</h1>
        <p style="color:#7f8c8d; margin-bottom: 40px;">Review your decisions before proceeding to the next quarter.</p>


        {% if sales_table and sales_table|length > 0 %}
        <div style="background: white; padding: 30px; border-radius: 8px; margin-bottom: 40px; border: 1px solid #ecf0f1;">
            <h2 style="margin-bottom: 20px; color: #2c3e50;"> Sales Report - Last Turn</h2>
            <div style="overflow-x: auto;">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th style="min-width: 150px;">Market - Product</th>
                            {% for company in all_companies %}
                            <th style="text-align: center; min-width: 80px;">
                                {{ company }}
                                {% if company == "Player" %}<br><span style="font-size:0.8em; color:#27ae60;"> YOU</span>{% endif %}
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in sales_table %}
                        <tr>
                            <td>
                                <strong>{{ row.country }} - Product {{ row.product }}</strong>
                                <br><span style="font-size:0.85em; color:#95a5a6;">(Max demand: {{ row.base_demand }})</span>
                            </td>
                            {% for company in all_companies %}
                            <td style="text-align: center; {% if company == 'Player' %}background: #e8f8f5;{% endif %}">
                                {% if row.sales.get(company, 0) > 0 %}
                                    <strong style="color: #27ae60;">{{ row.sales[company] }}</strong>
                                {% else %}
                                    <span style="color: #bdc3c7;">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% if ranking and ranking|length > 0 %}
        <div style="background: white; padding: 30px; border-radius: 8px; margin-bottom: 40px; border: 1px solid #ecf0f1;">
            <h2 style="margin-bottom: 20px; color: #2c3e50;"> Current Ranking</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th style="width: 80px;">Rank</th>
                        <th>Company</th>
                        <th style="text-align: right;">Cash</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in ranking %}
                    <tr {% if entry.is_player %}class="player-row"{% endif %}>
                        <td>
                            <span class="rank-badge {% if entry.rank == 1 %}rank-1{% elif entry.rank == 2 %}rank-2{% elif entry.rank == 3 %}rank-3{% else %}rank-other{% endif %}">
                                {{ entry.rank }}
                            </span>
                        </td>
                        <td>
                            {{ entry.name }}
                            {% if entry.is_player %}<span style="color:#27ae60; margin-left:8px;"> YOU</span>{% endif %}
                        </td>
                        <td style="text-align: right; font-weight: 600; color: #27ae60; font-size: 1.1em;">
                            ${{ "{:,.0f}".format(entry.cash) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <div style="background: #fadbd8; padding: 20px; border-radius: 8px; border: 1px solid #e6b0aa;">
            <h3 style="color: #c0392b; margin-bottom: 10px;">Ready to finalize?</h3>
            <p style="margin-bottom: 20px;">Once you end the turn, all production and sales decisions are final.</p>
            
            <form action="/end_turn" method="POST">
                <button type="submit" 
                        style="background-color: #c0392b; color: white; border: none; padding: 15px 30px; font-size: 1.2em; font-weight: bold; border-radius: 5px; cursor: pointer; width: 100%;">
                     EXECUTE TURN {{ current_turn }}
                </button>
            </form>
        </div>

    </div>
</body>
</html>
